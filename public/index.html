<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Web APIs</title>
</head>
<body>
    <form id="api-form">
        <div>
            <label for="nome">Nome:</label>
            <input type="text" id="nome">
        </div>
        <div>
            <label for="sobrenome">Sobrenome:</label>
            <input type="text" id="sobrenome">
        </div>
        <div>
            <label for="idade">Idade:</label>
            <input type="number" id="idade">
        </div>

        <input type="submit" value="Enviar">
    </form>

    <button id="receber">Receber dados</button>

    <div id="conteudo">

    </div>

    <script>
        document.getElementById('receber').onclick = function(e) {
            e.preventDefault();

            fetch('http://localhost:3000/api/users')
            .then(function(response) {
                return response.json();
            })
            .then(function(itens) {
                var conteudo = document.getElementById('conteudo');
                var html = '';

                for (var item of itens) {
                    html += '<br><br>Nome: ' + item.nome;
                    html += '<br>Sobrenome: ' + item.sobrenome;
                    html += '<br>Idade: ' + item.idade;
                }

                conteudo.innerHTML = html;
            });
        }

        document.getElementById('api-form').onsubmit = function(e) {
            e.preventDefault();

            fetch('http://localhost:3000/api/users', {
                method: 'POST',
                headers: {
                    'Content-type': 'application/json'
                },
                body: JSON.stringify({
                    nome: document.getElementById('nome').value,
                    sobrenome: document.getElementById('sobrenome').value,
                    idade: document.getElementById('idade').value,
                })
            })
            .then(function(response) {
                console.log(response);
                if (response.status == 201) {
                    alert('Usuário criado com sucesso');
                } else {
                    alert('Houve um erro ao criar usuário');
                }
                return response.json();
            })
            .then(function(conteudo) {
                console.log(conteudo);
            });
        }
    </script>
</body>
</html>